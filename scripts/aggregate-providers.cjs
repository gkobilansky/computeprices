#!/usr/bin/env node
/**
 * Aggregate individual provider JSON files into a single TypeScript module.
 * Run during build to generate data/providers.generated.ts
 */

const fs = require('fs');
const path = require('path');

const providersDir = path.join(__dirname, '../data/providers');
const outputPath = path.join(__dirname, '../data/providers.generated.ts');

// Get all JSON files in providers directory
const files = fs.readdirSync(providersDir)
  .filter(f => f.endsWith('.json'))
  .sort();

if (files.length === 0) {
  console.error('No provider JSON files found in', providersDir);
  process.exit(1);
}

// Read all provider files
const providers = files.map(filename => {
  const filepath = path.join(providersDir, filename);
  const content = fs.readFileSync(filepath, 'utf8');
  try {
    return JSON.parse(content);
  } catch (error) {
    console.error(`Error parsing JSON in file: ${filename}`);
    console.error(`  Path: ${filepath}`);
    console.error(`  ${error.message}`);
    process.exit(1);
  }
});

// Generate TypeScript module
const output = `// AUTO-GENERATED FILE - DO NOT EDIT DIRECTLY
// Generated by scripts/aggregate-providers.cjs
// Edit individual files in data/providers/*.json instead

import type { Provider } from '@/types/comparison'

const providers: Provider[] = ${JSON.stringify(providers, null, 2)} as const

export default providers
`;

fs.writeFileSync(outputPath, output);
console.log(`Generated ${outputPath} with ${providers.length} providers`);
